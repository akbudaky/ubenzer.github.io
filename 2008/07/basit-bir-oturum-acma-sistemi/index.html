<!doctype html>
    <html lang="tr">
      <head>
        <title>Basit Bir Oturum Açma Sistemi - UBenzer</title>
        <meta content="utf-8" name="charset"/><meta content="width=device-width, initial-scale=1.0" name="viewport"/><meta content="#2196F3" name="theme-color"/>
        <link href="/template/ui.css" media="screen" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Roboto:400,400i,700,700i&amp;amp;subset=latin-ext" media="screen" rel="stylesheet" type="text/css"/><link href="/img/favicon/apple-touch-icon-57x57.png" rel="apple-touch-icon-precomposed" sizes="57x57"/><link href="/img/favicon/apple-touch-icon-60x60.png" rel="apple-touch-icon-precomposed" sizes="60x60"/><link href="/img/favicon/apple-touch-icon-72x72.png" rel="apple-touch-icon-precomposed" sizes="72x72"/><link href="/img/favicon/apple-touch-icon-76x76.png" rel="apple-touch-icon-precomposed" sizes="76x76"/><link href="/img/favicon/apple-touch-icon-114x114.png" rel="apple-touch-icon-precomposed" sizes="114x114"/><link href="/img/favicon/apple-touch-icon-120x120.png" rel="apple-touch-icon-precomposed" sizes="120x120"/><link href="/img/favicon/apple-touch-icon-152x152.png" rel="apple-touch-icon-precomposed" sizes="152x152"/><link href="/img/favicon/favicon-196x196.png" rel="icon" sizes="196x196"/><link href="/img/favicon/favicon-128x128.png" rel="icon" sizes="128x128"/><link href="/img/favicon/favicon-96x96.png" rel="icon" sizes="96x96"/><link href="/img/favicon/favicon-32x32.png" rel="icon" sizes="32x32"/><link href="/img/favicon/favicon-16x16.png" rel="icon" sizes="16x16"/>
      </head>
      <body>
        <div><header class="header"><div class="app-bar"><h1 class="app-bar__title"><a class="app-bar__title-link" href="/">UBenzer</a></h1></div></header><div class="main-container"><div class="main-content"><article class="card main-container__items"><div class="card__contents blog-post"><div class="blog-post__date">11 Temmuz 2008</div><h1><a class="blog-post__title" href="/2008/07/basit-bir-oturum-acma-sistemi/">Basit Bir Oturum Açma Sistemi</a></h1><div class="markdown-content blog-post__body blog-post__content"><blockquote>
<p><em>CİDDEN ÖNEMLİ NOT:</em> Bu kod parçası güncel haliyle GÜVENLİK AÇIĞI İÇERMEKTEDİR. DEĞİŞİKLİK YAPMADAN KULLANMAYINIZ! Aksi halde sorumluluğun S’sini almayacağımı bizzat belirtirim.</p>
</blockquote>
<p>Birkaç gün önce hem <em>PHP Session</em>’ların ne olduğunu ve nasıl kullanıldığını öğrenmek, hem <a href="http://www.yakuter.com/ezsql-veritabani-sinifinin-kullanimi/" rel="noopener noreferrer" target="_blank">yakuter’in anlattığı</a> <a href="http://justinvincent.com/ezsql" rel="noopener noreferrer" target="_blank">ezSQL</a> sınıflarının nasıl kullanıldığını öğrenmek, hem de belki ileride bir projede kullanırım kalsın bir köşede dediğim için gerçekten çok basit bir oturum açma sistemi yazdım.</p>
<p>Sistem, girilen kullanıcı adı ve şifreyi veritabanında arıyor, eğer doğruysa oturum açıyor. Oturumun açık olup olmadığı proje esnasında is_logged() isimli fonksiyon ile kolaylıkla kontrol edilebiliyor.</p>
<p>Projede oturum açılıp açılmadığı kullanıcının tarayıcısına yazılan bir çerez (cookie) yerine, sunucu bazlı sessionlar tarafından belirleniyor. Bu da cookie desteklemeyen tarayıcılarda bile sorun yaratmamasını sağlayacaktır.</p>
<p>Proje Dosyaları</p>
<blockquote>
<p><em>index.php</em> Başlangıç işlerini yapar. Kullanıcı hangi sayfayı istiyor olursa olsun bu sayfadan geçmek zorundadır.</p>
</blockquote>
<pre><code class="language-php"> &lt;?php

/* Projenin diğer dosyaları doğrudan çağrılınca çalışmamaları için */ /* Other php's of project shouldn't call directly. */ define('DUYURU',1);

/* Session */ session_start(); header('Content-Type: text/html; charset=utf-8');

/* Veritabanı ve Fonksiyonlar*/ /* Database and Functions */ require_once(&quot;./db/settings.php&quot;); /* Genel ve veritabanı ayarlarını tutar. General and database connection settings. */ require_once(&quot;functions.php&quot;); /* Projenin gerekli fonksiyonlarını içerir. Functions needed by this project. */

/* Post-Get İşleyici: Eğer sayfaya get ya da post verileriyle gelinirse gerekli fonksiyonlara yönlendirme yapılır. */ /* Post-Get Processor: If user sent data includes POST or GET data, then user redirects to proper function. */ if (isset($_GET['action'])) { switch ($_GET['action']) { case 'logout': logout(); break; case 'login': login(); break; } } /* Post-Get İşleyici Bitti*/ /* End of Post-Get Processor */

/* Çıktı Başlangıcı */ /* Projenin bu adımından sonra istediğiniz çıktıyı alabilrisiniz. Oturum açılıp açılmadığını projinizin herhangi bir noktasında is_logged() fonksiyonu ile yapabilirsiniz. is_logged: Eğer oturum açıldıysa 1, oturum açılmadıysa 0 döndürür. Örnek kod aşağıdadır. */

/* Start of Output */ /* At this stage of project. You can output whatevet you want. If you want to check if user logged in or not, just use is_logged() function. is_logged: If user logged returns 1, else returns 0\. Sample code is bellow. */

if (!is_logged()) { ?&gt; &lt;form name=&quot;loginform&quot; id=&quot;loginform&quot; action=&quot;index.php?action=login&quot; method=&quot;post&quot;&gt; &lt;p&gt; &lt;label&gt;Kullanıcı adı&lt;br /&gt; &lt;input type=&quot;text&quot; name=&quot;user&quot; id=&quot;user&quot; class=&quot;input&quot; value=&quot;&quot; size=&quot;20&quot; tabindex=&quot;10&quot; /&gt;&lt;/label&gt; &lt;/p&gt; &lt;p&gt; &lt;label&gt;Şifre&lt;br /&gt; &lt;input type=&quot;password&quot; name=&quot;pass&quot; id=&quot;pass&quot; class=&quot;input&quot; value=&quot;&quot; size=&quot;20&quot; tabindex=&quot;20&quot; /&gt;&lt;/label&gt; &lt;/p&gt; &lt;input name=&quot;key&quot; type=&quot;hidden&quot; value=&quot;&lt;?php echo(md5(session_id())); ?&gt;&quot;/&gt; &lt;p class=&quot;submit&quot;&gt; &lt;input type=&quot;submit&quot; id=&quot;wp-submit&quot; value=&quot;Giriş&quot; tabindex=&quot;100&quot; /&gt; &lt;/p&gt; &lt;/form&gt; &lt;?php } else { ?&gt; Tebrikler oturum açtın. Şimdi &lt;a href=&quot;index.php?action=logout&quot;&gt;kapat&lt;/a&gt;. :) &lt;?php } ?&gt;
</code></pre>
<blockquote>
<p><em>functions.php</em> Proje tarafından gerekli fonksiyonları içerir.</p>
</blockquote>
<pre><code class="language-php"> &lt;?php

if (!defined('DUYURU')) { /* You can't reach this page directly. */ /* Bu sayfaya doğrudan erişilemez. */ die('Yok artık Lebron James!'); }

function is_logged() { /* Return values: 1 = LOGGED; 0 = GUEST */ if (isset($_SESSION['logged'])) { return $_SESSION['logged']; } else { return 0; } }

function login() { /* Zaten açık oturumu bir daha açamayız. */ /* Can't login, if person already logged in. */ if (!$_SESSION['logged'] == 1) { /* Input values; $_POST['user'] = user_name $_POST['pass'] = password $_POST['key'] = session in md5 */ /* Return values: 1: Login OK, $_SESSION['logged'] = 1; -1: Login Failed. */ global $db, $prefix, $mesaj; if (!(isset($_POST['user']) &amp;&amp; isset($_POST['pass']) &amp;&amp; isset($_POST['key']))) { $mesaj = 'invalid_data'; return -1; } $session = htmlspecialchars($_POST['key']); $user = htmlspecialchars($_POST['user']); $pass = htmlspecialchars($_POST['pass']); if (htmlspecialchars(md5(session_id())) != $session) { $mesaj = 'session_invalid'; return -1; } if ($user == NULL || $user == &quot;&quot; || $pass == NULL || $pass == &quot;&quot;) { $mesaj = 'invalid_data'; return -1; } $sonuc = $db-&gt;get_row('SELECT pass FROM '.$prefix.'user WHERE name = &quot;'.$user.'&quot;'); if (md5($pass) == $sonuc-&gt;pass &amp;&amp; $_SESSION['logged'] != 1) { $sonuc = $db-&gt;get_row('SELECT ID, name, real_name, login_count FROM '.$prefix.'user WHERE name = &quot;'.$user.'&quot;'); $_SESSION['name'] = $sonuc-&gt;name; $_SESSION['real_name'] = $sonuc-&gt;real_name; $_SESSION['ID'] = $sonuc-&gt;ID; $db-&gt;query('UPDATE '.$prefix.'user SET login_count = &quot;'.++$sonuc-&gt;login_count.'&quot; WHERE ID = &quot;'.$_SESSION['ID'].'&quot;'); $db-&gt;query('UPDATE '.$prefix.'user SET last_login = NOW() WHERE ID = &quot;'.$_SESSION['ID'].'&quot;');

$_SESSION['logged'] = 1; header('Location: index.php'); return 1; }

$mesaj = 'invalid_data'; return -1; } }

function logout() { /* Açık olmayan oturumun nesini sonlandıracağım! */ /* Can't logoff, if person is not login. */ if ($_SESSION['logged'] == 1) { global $mesaj; $_SESSION['logged'] = 0; $mesaj = 'logged_out'; } } ?&gt;
</code></pre>
<blockquote>
<p><em>db/settings.php</em> Veritabanı bağlantı ayarlarını içerir. ezSQL ile bağlantı kurar.</p>
</blockquote>
<pre><code class="language-php"> &lt;?php

if (!defined('DUYURU')) { /* You can't reach this page directly. */ /* Bu sayfaya doğrudan erişilemez. */ die('Yasak. :)'); }

/* ez_SQL sınıfları çağırılır. */ /* ez_SQL classes */ include (&quot;./db/core.php&quot;); include (&quot;./db/mysql.php&quot;);

/* Sunucu Ayarları */ $db_server = 'localhost'; $db_name = 'veritabanı_adı'; $db_user = 'veritabanı_kullanıcısı'; $db_passwd = 'veritabanı_şiresi'; $prefix = &quot;log_&quot;; /* Veritaanı öneki. */ $version = 0.1; /* Proje sürümü - Project version */

$db = new ezSQL_mysql($db_user,$db_passwd,$db_name,$db_server);

/* GEREKLİ VERİTABANI TABLOSU YAPISI - REQUIRED DATABASE TABLE STRUCTURE */

/* CREATE TABLE IF NOT EXISTS `log_user` ( `ID` int(11) NOT NULL auto_increment, `name` text NOT NULL, `pass` text NOT NULL, `real_name` text NOT NULL, `last_login` datetime NOT NULL default '0000-00-00 00:00:00', `login_count` int(11) NOT NULL default '0', PRIMARY KEY (`ID`) ) ENGINE=MyISAM DEFAULT CHARSET=utf8 AUTO_INCREMENT=2 ;

INSERT INTO `yse_user` (`ID`, `name`, `pass`, `real_name`, `last_login`, `login_count`) VALUES (1, 'Umut', '202cb962ac59075b964b07152d234b70', 'Umut Benzer', '2008-07-09 01:56:10', 0);

*/

/* Bu tablo ile kullanıcı adı Umut şifre 123 olan bir test kullanıcısı yaratılır. */ /* With this table a test user created with username Umut pass 123 */

?&gt;
``` Projenin tüm dosyalarını (ve ezSQL sınıflarını) [buradan indirebilirsiniz](loginout.zip). Dosya, veritabanı tablosunu yaratmak için gerekli SQL satırlarını da içerir.

*Sistem Gereksinimleri:* PHP 4+, MySQL
</code></pre>
</div></div></article><div class="card comments main-container__items"><div class="card__contents" id="disqus_thread"></div></div></div><div class="sidebar main-content__sidebar"><div class="about"><img class="about__image" src="/img/profile.jpg"/><h1 class="about__name">Umut Benzer</h1><h2 class="about__mini-bio">Software Engineer in Berlin</h2></div></div></div><div class="main-container"><div class="footer"><div class="footer__copyright-holder"><p><a href="http://creativecommons.org/licenses/by-nc-nd/4.0/" rel="license noopener noreferrer" target="_blank"><img alt="Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License" src="/img/cclicense.png"/></a></p><p><span>Bu sitedeki tüm yazı ve görseller </span><a href="http://creativecommons.org/licenses/by-nc-nd/4.0/" rel="license noopener noreferrer" target="_blank">Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License</a><span> ile lisanslanmıştır.</span></p></div><div class="footer__generator"><span>Bu sayfa </span><span>20 Nisan 2017</span><span> tarihinde </span><a href="https://github.com/ubenzer/fil" target="_blank">Fil</a><span> ile yaratılmıştır.</span></div></div></div></div>
        <script src="/template/app.js" type="text/javascript"></script><script type="text/javascript">
        var disqus_config = function () {
          this.page.url = "https://ubenzer.com/2008/07/basit-bir-oturum-acma-sistemi/";
          this.page.identifier = "post@/2008/07/basit-bir-oturum-acma-sistemi";
        };
        (function() {
          var d = document, s = d.createElement('script');
          s.src = 'https://ubenzer.disqus.com/embed.js';
          s.setAttribute('data-timestamp', +new Date());
          (d.head || d.body).appendChild(s);
        })();
        </script><script type="text/javascript">
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-509698-8', 'auto');
      ga('send', 'pageview');
      </script>
      </body>
    </html>
  